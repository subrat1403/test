<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Expense Split</title>

<style>
body {
    font-family: Arial, sans-serif;
    background: #f4f6f8;
    padding: 10px;
}
.container {
    max-width: 480px;
    margin: auto;
    background: #fff;
    padding: 15px;
    border-radius: 10px;
}
h1, h2 {
    text-align: center;
}
label {
    font-weight: bold;
    font-size: 14px;
}
input, select, button {
    width: 100%;
    padding: 10px;
    margin-top: 6px;
    margin-bottom: 12px;
    font-size: 15px;
}
button {
    background: #007bff;
    color: white;
    border: none;
    border-radius: 6px;
}
table {
    width: 100%;
    border-collapse: collapse;
    font-size: 14px;
}
th, td {
    border: 1px solid #ddd;
    padding: 8px;
    text-align: center;
}
th {
    background: #007bff;
    color: white;
}
.positive { color: green; font-weight: bold; }
.negative { color: red; font-weight: bold; }
.delete-btn {
    background: red;
    padding: 6px;
    font-size: 13px;
}
.hidden { display: none; }
</style>
</head>

<body>

<div class="container">
<h1>Expense Split</h1>

<!-- FRIEND SETUP -->
<div id="setupSection">
    <button onclick="showNameInputs()">➕ Add Friends</button>
    <div id="nameInputs" class="hidden"></div>
    <button id="saveBtn" class="hidden" onclick="saveFriends()">Save Friends</button>
</div>

<!-- MAIN APP -->
<div id="appSection" class="hidden">

<h2>Add Bill</h2>

<label>Subject / Purpose</label>
<input type="text" id="subject" placeholder="Dinner, Fuel, Trip">

<label>Amount (₹)</label>
<input type="number" id="amount">

<label>Paid By</label>
<select id="paidBy"></select>

<label>Split Between</label>
<select id="friends" multiple></select>

<button onclick="addBill()">Add Bill</button>

<h2>Total Spent: ₹ <span id="totalExpense">0</span></h2>

<h2>Balances</h2>
<table>
<thead><tr><th>Name</th><th>₹</th></tr></thead>
<tbody id="balanceTable"></tbody>
</table>

<h2>Subject-wise Spending</h2>
<table>
<thead><tr><th>Subject</th><th>Total ₹</th></tr></thead>
<tbody id="subjectTable"></tbody>
</table>

<h2>Bills</h2>
<table>
<thead>
<tr><th>Subject</th><th>₹</th><th>Paid</th><th>Split</th><th></th></tr>
</thead>
<tbody id="billTable"></tbody>
</table>

<h2>Settlement</h2>
<table>
<thead><tr><th>Pays</th><th>Gets</th><th>₹</th></tr></thead>
<tbody id="settlementTable"></tbody>
</table>

</div>
</div>

<script>
let friends=[], balances=[], bills=[], totalExpense=0;
const MAX_FRIENDS = 7;

function showNameInputs(){
    let d=document.getElementById("nameInputs");
    d.innerHTML="";
    for(let i=0;i<MAX_FRIENDS;i++){
        d.innerHTML+=`<input placeholder="Friend ${i+1} name">`;
    }
    d.classList.remove("hidden");
    saveBtn.classList.remove("hidden");
}

function saveFriends(){
    friends=[...document.querySelectorAll("#nameInputs input")]
            .map((i,x)=>i.value||`Friend ${x+1}`);
    balances=new Array(friends.length).fill(0);
    setupSection.classList.add("hidden");
    appSection.classList.remove("hidden");
    initSelectors();
    updateBalances();
}

function initSelectors(){
    paidBy.innerHTML=`<option value="">Select</option>`;
    friendsSelect.innerHTML="";
    friends.forEach((n,i)=>{
        paidBy.innerHTML+=`<option value="${i}">${n}</option>`;
        friendsSelect.innerHTML+=`<option value="${i}">${n}</option>`;
    });
}

function addBill(){
    let subject=subjectInput.value||"General";
    let amt=+amount.value;
    let payer=paidBy.value;
    let split=[...friendsSelect.selectedOptions].map(o=>+o.value);
    if(!amt||payer===""||!split.length){alert("Fill all fields");return;}
    bills.push({subject,amt,payer,split});
    subjectInput.value=""; amount.value=""; friendsSelect.selectedIndex=-1;
    recalc();
}

function deleteBill(i){ bills.splice(i,1); recalc(); }

function recalc(){
    balances.fill(0); totalExpense=0;
    bills.forEach(b=>{
        totalExpense+=b.amt;
        balances[b.payer]+=b.amt;
        let s=b.amt/b.split.length;
        b.split.forEach(f=>balances[f]-=s);
    });
    totalExpenseSpan.innerText=totalExpense.toFixed(2);
    updateBalances(); renderBills(); renderSubjects(); settlement();
}

function updateBalances(){
    balanceTable.innerHTML="";
    balances.forEach((b,i)=>{
        balanceTable.innerHTML+=`
        <tr><td>${friends[i]}</td>
        <td class="${b>=0?'positive':'negative'}">₹ ${b.toFixed(2)}</td></tr>`;
    });
}

function renderBills(){
    billTable.innerHTML="";
    bills.forEach((b,i)=>{
        billTable.innerHTML+=`
        <tr>
        <td>${b.subject}</td><td>${b.amt}</td>
        <td>${friends[b.payer]}</td>
        <td>${b.split.map(x=>friends[x]).join(", ")}</td>
        <td><button class="delete-btn" onclick="deleteBill(${i})">✕</button></td>
        </tr>`;
    });
}

function renderSubjects(){
    let map={};
    bills.forEach(b=>map[b.subject]=(map[b.subject]||0)+b.amt);
    subjectTable.innerHTML="";
    Object.keys(map).forEach(s=>{
        subjectTable.innerHTML+=`
        <tr><td>${s}</td><td>₹ ${map[s].toFixed(2)}</td></tr>`;
    });
}

function settlement(){
    settlementTable.innerHTML="";
    let d=[],c=[];
    balances.forEach((b,i)=>{if(b<0)d.push({i,a:-b});if(b>0)c.push({i,a:b});});
    let i=0,j=0;
    while(i<d.length&&j<c.length){
        let p=Math.min(d[i].a,c[j].a);
        settlementTable.innerHTML+=`
        <tr><td>${friends[d[i].i]}</td>
        <td>${friends[c[j].i]}</td><td>₹ ${p.toFixed(2)}</td></tr>`;
        d[i].a-=p; c[j].a-=p;
        if(!d[i].a)i++; if(!c[j].a)j++;
    }
}

/* shortcuts */
const paidBy=document.getElementById("paidBy");
const friendsSelect=document.getElementById("friends");
const subjectInput=document.getElementById("subject");
const amount=document.getElementById("amount");
const totalExpenseSpan=document.getElementById("totalExpense");
</script>

</body>
</html>
